<pre style='color:#000000;background:#ffffff;'><html><body style='color:#000000; background:#ffffff; '><pre>
<span style='color:#004a43; '># </span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>cstdio</span><span style='color:#800000; '>></span>
<span style='color:#004a43; '># </span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>cmath</span><span style='color:#800000; '>></span>
<span style='color:#004a43; '># </span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>omp.h</span><span style='color:#800000; '>></span>
<span style='color:#004a43; '># </span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>fstream</span><span style='color:#800000; '>></span>

<span style='color:#800000; font-weight:bold; '>int</span> <span style='color:#400000; '>main</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
<span style='color:#800080; '>{</span>
    <span style='color:#800000; font-weight:bold; '>int</span>     level<span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>double</span>  f<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>double</span> x<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>double</span>  adapt_quad<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>double</span> a<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>double</span> b<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>double</span> fa<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>double</span> fb<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>int</span> level<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>double</span>  approx<span style='color:#800080; '>;</span>
    <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>ofstream</span> myfile<span style='color:#800080; '>;</span>
    myfile<span style='color:#808030; '>.</span>open <span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>result.txt</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span><span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>fstream</span><span style='color:#800080; '>::</span>trunc<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    myfile <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>a</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>b</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>level</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>integ_s</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>err</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>cpuid</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>"</span><span style='color:#800080; '>;</span>
    myfile<span style='color:#808030; '>.</span>close<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    omp_set_nested<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    approx<span style='color:#808030; '>=</span>adapt_quad<span style='color:#808030; '>(</span><span style='color:#808030; '>-</span><span style='color:#008000; '>2.0</span><span style='color:#808030; '>,</span><span style='color:#008000; '>4.0</span><span style='color:#808030; '>,</span>f<span style='color:#808030; '>(</span><span style='color:#808030; '>-</span><span style='color:#008000; '>2.0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>f<span style='color:#808030; '>(</span><span style='color:#008000; '>4.0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span><span style='color:#008000; '>0.0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#696969; '>//approx=adapt_quad(0,M_PI,f(0.0),f(M_PI),0.0);</span>

<span style='color:#004a43; '>&#xa0;&#xa0;&#xa0;&#xa0;# </span><span style='color:#004a43; font-weight:bold; '>pragma </span><span style='color:#bb7977; font-weight:bold; '>omp single</span>
        <span style='color:#800080; '>{</span>
        <span style='color:#603000; '>printf</span><span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>Integral= </span><span style='color:#0f69ff; '>%f</span><span style='color:#0000e6; '> </span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span>approx<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
        <span style='color:#800080; '>}</span>
    <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>

<span style='color:#800080; '>}</span>

<span style='color:#800000; font-weight:bold; '>double</span> f<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>double</span> x<span style='color:#808030; '>)</span>
<span style='color:#800080; '>{</span>
    <span style='color:#800000; font-weight:bold; '>double</span> out<span style='color:#800080; '>;</span>
    out<span style='color:#808030; '>=</span> <span style='color:#603000; '>sin</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>+</span> <span style='color:#603000; '>exp</span><span style='color:#808030; '>(</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>100</span><span style='color:#808030; '>*</span>x<span style='color:#808030; '>*</span>x<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>return</span> out<span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>

<span style='color:#800000; font-weight:bold; '>double</span> adapt_quad<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>double</span> a<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>double</span> b<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>double</span> fa<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>double</span> fb<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>int</span> level<span style='color:#808030; '>)</span>
<span style='color:#800080; '>{</span>
    <span style='color:#800000; font-weight:bold; '>double</span> mid_p<span style='color:#808030; '>,</span>f_mid_p<span style='color:#808030; '>,</span>integ_s<span style='color:#808030; '>,</span>integ_t<span style='color:#808030; '>,</span>err<span style='color:#808030; '>,</span>s1<span style='color:#808030; '>,</span>s2<span style='color:#800080; '>;</span>
    <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>ofstream</span> myfile<span style='color:#800080; '>;</span>
    level<span style='color:#808030; '>=</span>level<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
    mid_p<span style='color:#808030; '>=</span><span style='color:#808030; '>(</span>a<span style='color:#808030; '>+</span>b<span style='color:#808030; '>)</span><span style='color:#808030; '>/</span><span style='color:#008000; '>2.0</span><span style='color:#800080; '>;</span>
    f_mid_p<span style='color:#808030; '>=</span>f<span style='color:#808030; '>(</span>mid_p<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    integ_s<span style='color:#808030; '>=</span><span style='color:#808030; '>(</span>b<span style='color:#808030; '>-</span>a<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span>fa<span style='color:#808030; '>+</span>fb<span style='color:#808030; '>+</span><span style='color:#008c00; '>4</span><span style='color:#808030; '>*</span>f_mid_p<span style='color:#808030; '>)</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>6</span><span style='color:#800080; '>;</span>
    integ_t<span style='color:#808030; '>=</span><span style='color:#808030; '>(</span>fb<span style='color:#808030; '>+</span>fa<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span>b<span style='color:#808030; '>-</span>a<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#008000; '>0.5</span><span style='color:#800080; '>;</span>
    err<span style='color:#808030; '>=</span><span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>abs</span><span style='color:#808030; '>(</span>integ_s <span style='color:#808030; '>-</span> integ_t<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    myfile<span style='color:#808030; '>.</span>open <span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>result.txt</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span><span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>fstream</span><span style='color:#800080; '>::</span>in <span style='color:#808030; '>|</span> <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>fstream</span><span style='color:#800080; '>::</span>out <span style='color:#808030; '>|</span> <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>fstream</span><span style='color:#800080; '>::</span>app<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    myfile <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span>a<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span>b<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span>level<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span>integ_s<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span>err<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#800000; '>"</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span>omp_get_thread_num<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>"</span><span style='color:#800080; '>;</span>
    myfile<span style='color:#808030; '>.</span>close<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>level<span style='color:#808030; '>&lt;</span><span style='color:#008c00; '>30</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>err<span style='color:#808030; '>></span><span style='color:#008000; '>0.001</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>  
    <span style='color:#800080; '>{</span>

<span style='color:#004a43; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#</span><span style='color:#004a43; font-weight:bold; '>pragma </span><span style='color:#bb7977; font-weight:bold; '>omp parallel sections num_threads(2)</span>
            <span style='color:#800080; '>{</span>
<span style='color:#004a43; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;# </span><span style='color:#004a43; font-weight:bold; '>pragma </span><span style='color:#bb7977; font-weight:bold; '>omp section</span>
            <span style='color:#800080; '>{</span>
                s1<span style='color:#808030; '>=</span>adapt_quad<span style='color:#808030; '>(</span>a<span style='color:#808030; '>,</span>mid_p<span style='color:#808030; '>,</span>fa<span style='color:#808030; '>,</span>f_mid_p<span style='color:#808030; '>,</span>level<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
            <span style='color:#800080; '>}</span>
<span style='color:#004a43; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;# </span><span style='color:#004a43; font-weight:bold; '>pragma </span><span style='color:#bb7977; font-weight:bold; '>omp section</span>
            <span style='color:#800080; '>{</span>
                s2<span style='color:#808030; '>=</span>adapt_quad<span style='color:#808030; '>(</span>mid_p<span style='color:#808030; '>,</span>b<span style='color:#808030; '>,</span>f_mid_p<span style='color:#808030; '>,</span>fb<span style='color:#808030; '>,</span>level<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
            <span style='color:#800080; '>}</span>
        <span style='color:#800080; '>}</span>
        <span style='color:#800000; font-weight:bold; '>return</span> s1<span style='color:#808030; '>+</span>s2<span style='color:#800080; '>;</span>
     <span style='color:#800080; '>}</span>
    <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800000; font-weight:bold; '>return</span> integ_s<span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>
</pre>
